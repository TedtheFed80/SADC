<!DOCTYPE html>
const fileList = document.getElementById('fileList');


function renderFileList(files) {
if (!files || files.length === 0) { fileList.innerHTML = '<em>No files selected.</em>'; return; }
const items = Array.from(files).map(f => `\n <div>â€¢ ${f.name} <small>(${(f.size/1024/1024).toFixed(2)} MB)</small></div>`).join('');
fileList.innerHTML = items;
}


dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });
dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
dropzone.addEventListener('drop', (e) => {
e.preventDefault(); dropzone.classList.remove('dragover');
videoInput.files = e.dataTransfer.files;
renderFileList(videoInput.files);
});
videoInput.addEventListener('change', () => renderFileList(videoInput.files));


// Export JSON (download a JSON of the application)
document.getElementById('exportJsonBtn').addEventListener('click', () => {
const form = document.getElementById('warrantForm');
if (!form.reportValidity()) return;
const data = {
defendantName: document.getElementById('defendantName').value.trim(),
defendantCid: document.getElementById('defendantCid').value.trim(),
probableCause: document.getElementById('pc').value.trim(),
videoFiles: Array.from(videoInput.files).map(f => ({ name: f.name, sizeBytes: f.size, type: f.type }))
};
const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
const safeName = (data.defendantName || 'warrant').replace(/[^a-z0-9\-]+/gi, '_');
a.href = url; a.download = `${safeName}_warrant_application.json`;
document.body.appendChild(a); a.click(); URL.revokeObjectURL(url); a.remove();
});


// Print-friendly preview
document.getElementById('printBtn').addEventListener('click', () => {
const form = document.getElementById('warrantForm');
if (!form.reportValidity()) return;
const dt = new Date().toLocaleString();
const name = document.getElementById('defendantName').value.trim();
const cid = document.getElementById('defendantCid').value.trim();
const pc = document.getElementById('pc').value.trim().replace(/\n/g, '<br>');
const files = Array.from(videoInput.files).map(f => `<li>${f.name} (${(f.size/1024/1024).toFixed(2)} MB)</li>`).join('');


const w = window.open('', '_blank');
w.document.write(`
<html><head><title>Warrant Application Preview</title>
<style>
body{font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial; padding: 24px; color:#111}
h1{margin-top:0}
.meta{margin: 8px 0 16px;}
.box{border:1px solid #ccc;border-radius:8px;padding:12px;background:#fafafa}
</style></head><body>
<h1>Warrant Application</h1>
<div class="meta"><strong>Generated:</strong> ${dt}</div>
<div class="box"><strong>Defendant:</strong> ${name || '<em>(empty)</em>'}<br><strong>CID:</strong> ${cid || '<em>(empty)</em>'}</div>
<h3>Probable Cause Statement</h3>
<div class="box">${pc || '<em>(empty)</em>'}</div>
<h3>Video Evidence</h3>
<div class="box">${files ? '<ul>'+files+'</ul>' : '<em>No files selected</em>'}</div>
<script>window.print()</script>
</body></html>
`);
w.document.close();
});


// Placeholder for future real submission (backend)
async function submitApplication() {
// When you have a backend, you can switch the buttons to call this function.
// Example (uncomment and edit):
// const fd = new FormData();
// fd.append('defendantName', document.getElementById('defendantName').value);
// fd.append('defendantCid', document.getElementById('defendantCid').value);
// fd.append('probableCause', document.getElementById('pc').value);
// Array.from(videoInput.files).forEach(f => fd.append('videos', f));
// await fetch('https://your-agency-endpoint.example/submit', { method: 'POST', body: fd });
}
</script>
</body>
</html>
